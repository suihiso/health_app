{% extends "base.html" %}

{% block title %}–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö{% endblock %}

{% block content %}
<h2>–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</h2>
<hr>

<!-- –í—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö -->
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<div class="mt-2 mb-3">
    {% for category, message in messages %}
    <div class="alert alert-{{ category }}" role="alert">
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}
{% endwith %}

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ó–î–ï–°–¨" -->
<div class="modal fade" id="trainingConfirmModal" tabindex="-1" aria-labelledby="trainingConfirmModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="trainingConfirmModalLabel">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                –í–Ω–∏–º–∞–Ω–∏–µ! –í—ã –ø–æ–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–ª–∏ –Ω–∏–∫–∞–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö, –ø–æ—ç—Ç–æ–º—É –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∑–∞–≥—Ä—É–∑–∫–∏
                –¥–∞–Ω–Ω—ã—Ö. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ù–µ—Ç</button>
                <button type="button" class="btn btn-primary" onclick="redirectToIndex()">–î–∞</button>
            </div>
        </div>
    </div>
</div>

<!-- –ï–¥–∏–Ω–∞—è —Ñ–æ—Ä–º–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –∏ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è -->
<form method="POST" enctype="multipart/form-data" id="prediction-form" onsubmit="return validateForm()">
    <div class="row">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ -->
        <div class="col-md-6 border-end">
            <h4>–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è</h4>
            <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª —Å –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª—å—é –≤ —Ñ–æ—Ä–º–∞—Ç–µ JOBLIB:</p>

            <div class="input-group mb-3">
                <input type="file" class="form-control" name="model_file" id="model_file" accept=".joblib"
                    onchange="updateFileDisplay(this, 'model-file-name')">
                <input type="hidden" name="model_file_name" id="model-file-name">
            </div>

            <!-- –ë–ª–æ–∫ –¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –æ –Ω–µ–∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ -->
            <div class="alert alert-danger mt-2" id="model-error" style="display: none;">
                {% if model_error %}
                {{ model_error }}
                {% else %}
                –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è
                {% endif %}
            </div>

            <div class="card bg-light mb-3">
                <div class="card-body">
                    <p class="card-text">
                        <strong>–û–±—É—á–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å</strong> –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö ‚Äî —ç—Ç–æ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å,
                        –∫–æ—Ç–æ—Ä–∞—è
                        –ø—Ä–æ—à–ª–∞ –ø—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∏ —Ç–µ–ø–µ—Ä—å —Å–ø–æ—Å–æ–±–Ω–∞ –¥–µ–ª–∞—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –æ
                        –Ω–æ–≤—ã—Ö,
                        —Ä–∞–Ω–µ–µ –Ω–µ –≤—Å—Ç—Ä–µ—á–∞–≤—à–∏—Ö—Å—è –¥–∞–Ω–Ω—ã—Ö.
                    </p>
                    <p class="card-text mb-0">
                        –£ –≤–∞—Å –Ω–µ—Ç –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏? –û–±—É—á–∏—Ç–µ –º–æ–¥–µ–ª—å <a href="{{ url_for('training_models') }}"
                            class="fw-bold">–ó–î–ï–°–¨</a>
                    </p>
                </div>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö -->
        <div class="col-md-6">
            <h4>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</h4>
            <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª —Å –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–∞—Ö CSV –∏–ª–∏ Excel:</p>

            <div class="input-group mb-3">
                <input type="file" class="form-control" name="test_data_file" id="test_data_file"
                    accept=".csv, .xls, .xlsx" onchange="updateFileDisplay(this, 'data-file-name')">
                <input type="hidden" name="test_data_file_name" id="data-file-name">
            </div>

            <!-- –ë–ª–æ–∫ –¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –æ –Ω–µ–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö -->
            <div class="alert alert-danger mt-2" id="data-error" style="display: none;">
                {% if data_error %}
                {{ data_error }}
                {% else %}
                –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                {% endif %}
            </div>

            <div class="card bg-light mb-3">
                <div class="card-body">
                    <p class="card-text">
                        <strong>–ò–Ω—Ñ–µ—Ä–µ–Ω—Å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</strong> (inference data) ‚Äî —ç—Ç–æ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ
                        –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –∏–ª–∏ –≤—ã–≤–æ–¥–æ–≤.
                    </p>
                    <p class="card-text mb-0">
                        <strong>–í–ê–ñ–ù–û:</strong> –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–µ –∂–µ –ø—Ä–∏–∑–Ω–∞–∫–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö –æ–±—É—á–∞–ª–∞—Å—å
                        –º–æ–¥–µ–ª—å.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <hr>

    <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div class="text-center my-4">
        <button type="submit" class="btn btn-primary btn-lg" name="submit_action" value="predict">
            –°–¥–µ–ª–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑
        </button>
    </div>
</form>

<hr>

<!-- –ë–ª–æ–∫ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è -->
{% if predictions is defined %}
<div id="predictions-results" class="mt-4">
    <h3 class="text-center mb-3">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è</h3>

    <!-- –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
    <div class="alert alert-info py-2">
        <div class="d-flex justify-content-between flex-wrap">
            <span><strong>–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤:</strong> {{ prediction_count }}</span>
            <span><strong>–°—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ–≥–Ω–æ–∑–∞:</strong> {{ prediction_mean }}</span>
            <span><strong>–ú–∏–Ω–∏–º—É–º:</strong> {{ prediction_min }}</span>
            <span><strong>–ú–∞–∫—Å–∏–º—É–º:</strong> {{ prediction_max }}</span>
        </div>
    </div>

    <!-- –õ–∏–ø–∫–æ–µ –º–µ–Ω—é —Å —Ä–∞–∑–¥–µ–ª–∞–º–∏ -->
    <div class="anchor-nav mb-4 d-flex justify-content-between">
        <!-- –ö–Ω–æ–ø–∫–∏ —Å —Ä–∞–∑–¥–µ–ª–∞–º–∏ -->
        <div>
            <a href="#predictions-table" class="btn btn-outline-primary btn-sm">üìã –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤</a>
            <a href="#predictions-stats" class="btn btn-outline-primary btn-sm">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
            <a href="#predictions-hist" class="btn btn-outline-primary btn-sm">üìà –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π</a>
        </div>
        <!-- –ö–Ω–æ–ø–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è -->
        <div>
            <a href="{{ url_for('download_predictions') }}" class="btn btn-success btn-sm" data-bs-toggle="tooltip"
                title="–°–∫–∞—á–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –ø—Ä–æ–≥–Ω–æ–∑–æ–≤">
                <i class="fas fa-download"></i> –°–∫–∞—á–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑—ã
            </a>
            <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="tooltip"
                title="–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö" onclick="confirmUsePredictions()">
                <i class="fas fa-chart-line"></i> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≥–Ω–æ–∑—ã
            </button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
    <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmModalLabel">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    –í–Ω–∏–º–∞–Ω–∏–µ! –í—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—ã–±–æ—Ä–∞ –¥–µ–π—Å—Ç–≤–∏–π —Å –ø—Ä–æ–≥–Ω–æ–∑–∞–º–∏.
                    –ü—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –≤–∞–º–∏ —Ä–∞–Ω–µ–µ –¥–∞–Ω–Ω—ã—Ö <span
                        id="originalDatasetName"></span>
                    –±—É–¥–µ—Ç —É—Ç–µ—Ä—è–Ω–∞. –ï—Å–ª–∏ –≤—ã –∑–∞—Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å –Ω–∏–º–∏, —Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å
                    –∏—Ö —Å–Ω–æ–≤–∞ –≤ —Ä–∞–∑–¥–µ–ª–µ "–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö". –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ù–µ—Ç</button>
                    <button type="button" class="btn btn-primary" onclick="usePredictions()">–î–∞</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ -->
    <div id="predictions-table">
        <h4>üìã –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤</h4>

        <!-- –¢–∞–±–ª–∏—Ü–∞ -->
        <div class="table-responsive">
            {{ predictions_table | safe }}
        </div>

        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Å–Ω–∏–∑—É -->
        {% if total_pages > 1 %}
        <div class="d-flex justify-content-between align-items-center my-1">
            <!-- –ö–Ω–æ–ø–∫–∏ "–ü–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞" –∏ "–ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞" –≤—ã—Ä–æ–≤–Ω–µ–Ω–Ω—ã–µ –ø–æ –ª–µ–≤–æ–π —Å—Ç–æ—Ä–æ–Ω–µ -->
            <div class="btn-group">
                <a href="{{ url_for('forecasting', page=1) }}"
                    class="btn btn-outline-primary {% if current_page == 1 %}disabled{% endif %}">
                    –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
                </a>
                <a href="{{ url_for('forecasting', page=total_pages) }}"
                    class="btn btn-outline-primary {% if current_page == total_pages %}disabled{% endif %}">
                    –ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
                </a>
            </div>

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—Ä–æ–∫–∞—Ö –∏ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–µ–¥—ã–¥—É—â–∞—è/–°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞" –≤—ã—Ä–æ–≤–Ω–µ–Ω–Ω—ã–µ –ø–æ –ø—Ä–∞–≤–æ–π —Å—Ç–æ—Ä–æ–Ω–µ -->
            <div class="d-flex align-items-center">
                <span class="me-3">–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ current_page }} –∏–∑ {{ total_pages }}</span>
                <div class="btn-group">
                    <a href="{{ url_for('forecasting', page=current_page-1) }}"
                        class="btn btn-outline-primary {% if current_page == 1 %}disabled{% endif %}">
                        –ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
                    </a>
                    <a href="{{ url_for('forecasting', page=current_page+1) }}"
                        class="btn btn-outline-primary {% if current_page == total_pages %}disabled{% endif %}">
                        –°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
                    </a>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <hr>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div id="predictions-stats">
        <h4>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
        <div class="table-responsive">
            {{ stats_table | safe }}
        </div>
    </div>

    <hr>

    <!-- –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π -->
    <div id="predictions-hist">
        <h4>üìà –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π</h4>
        <div class="text-center">
            <img src="data:image/png;base64,{{ hist_image }}" class="img-fluid border"
                alt="–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤">
        </div>
    </div>
</div>
{% endif %}

<style>
    /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Ç–∞–±–ª–∏—Ü –ø–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é */
    .table th {
        text-align: left !important;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ */
    .btn-group .btn {
        padding: 0.375rem 0.75rem;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —è–∫–æ—Ä–µ–π –∏ —Å–µ–∫—Ü–∏–π */
    #predictions-table,
    #predictions-stats,
    #predictions-hist {
        scroll-margin-top: 80px;
    }

    /* –û—Ç—Å—Ç—É–ø—ã –¥–ª—è —Å–µ–∫—Ü–∏–π */
    hr+h4 {
        margin-top: 20px;
        padding-top: 10px;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        });

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä page –≤ URL
        const urlParams = new URLSearchParams(window.location.search);
        const page = urlParams.get('page');

        // –ï—Å–ª–∏ –µ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä page, –∑–Ω–∞—á–∏—Ç —ç—Ç–æ –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
        if (page) {
            // –ü–ª–∞–≤–Ω–æ –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ç–∞–±–ª–∏—Ü–µ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤
            document.getElementById('predictions-table').scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        const actionButton = document.querySelector('a[href="{{ url_for("select_action") }}"]');
        if (actionButton) {
            actionButton.addEventListener('click', function (e) {
                e.preventDefault();
                checkDatasetAndShowModal('actionConfirmModal');
            });
        }

        const exploreLink = document.querySelector('a[href="{{ url_for("explore") }}"]');
        if (exploreLink) {
            exploreLink.addEventListener('click', function (e) {
                e.preventDefault();
                checkDatasetAndShowModal('trainingConfirmModal');
            });
        }

        const processLink = document.querySelector('a[href="{{ url_for("process_data") }}"]');
        if (processLink) {
            processLink.addEventListener('click', function (e) {
                e.preventDefault();
                checkDatasetAndShowModal('trainingConfirmModal');
            });
        }

        const visualizeLink = document.querySelector('a[href="{{ url_for("visualize") }}"]');
        if (visualizeLink) {
            visualizeLink.addEventListener('click', function (e) {
                e.preventDefault();
                checkDatasetAndShowModal('trainingConfirmModal');
            });
        }

        const trainingLink = document.querySelector('a[href="{{ url_for("training_models") }}"]');
        if (trainingLink) {
            trainingLink.addEventListener('click', function (e) {
                e.preventDefault();
                checkDatasetAndShowModal('trainingConfirmModal');
            });
        }



        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–∏ —É—Ö–æ–¥–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('beforeunload', function () {
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –æ—á–∏—Å—Ç–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            fetch('/clear_predictions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            }).catch(error => console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', error));
        });
    });

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è –¥–∞—Ç–∞—Å–µ—Ç–∞ –∏ –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    function checkDatasetAndShowModal(modalId) {
        fetch('/check_dataset')
            .then(response => response.json())
            .then(data => {
                if (!data.has_dataset) {
                    var modal = new bootstrap.Modal(document.getElementById(modalId));
                    modal.show();
                } else {
                    // –ï—Å–ª–∏ –¥–∞—Ç–∞—Å–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –ø–æ –æ–±—ã—á–Ω–æ–π —Å—Å—ã–ª–∫–µ
                    if (modalId === 'actionConfirmModal') {
                        window.location.href = "{{ url_for('select_action') }}";
                    } else {
                        window.location.href = "{{ url_for('training_models') }}";
                    }
                }
            });
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
    function redirectToIndex() {
        window.location.href = "{{ url_for('index') }}";
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
    function confirmUsePredictions() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –¥–∞—Ç–∞—Å–µ—Ç–∞ –≤ —Å–µ—Å—Å–∏–∏
        fetch('/check_dataset')
            .then(response => response.json())
            .then(data => {
                if (data.has_dataset) {
                    // –ï—Å–ª–∏ –¥–∞—Ç–∞—Å–µ—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                    fetch('/get_original_dataset_name')
                        .then(response => response.json())
                        .then(data => {
                            document.getElementById('originalDatasetName').textContent = data.dataset_name;
                            var modal = new bootstrap.Modal(document.getElementById('confirmModal'));
                            modal.show();
                        });
                } else {
                    // –ï—Å–ª–∏ –¥–∞—Ç–∞—Å–µ—Ç–∞ –Ω–µ—Ç, —Å—Ä–∞–∑—É –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –ø—Ä–æ–≥–Ω–æ–∑–æ–≤
                    usePredictions();
                }
            });
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ–≥–Ω–æ–∑–æ–≤
    function usePredictions() {
        window.location.href = '/use_predictions';
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
    function updateFileDisplay(input, hiddenInputId) {
        const hiddenInput = document.getElementById(hiddenInputId);
        if (input.files.length > 0) {
            hiddenInput.value = input.files[0].name;
        } else {
            hiddenInput.value = '';
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–æ—Ä–º—ã –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
    function validateForm() {
        const modelFile = document.getElementById('model_file');
        const dataFile = document.getElementById('test_data_file');
        const modelError = document.getElementById('model-error');
        const dataError = document.getElementById('data-error');

        // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –æ—à–∏–±–∫–∏
        if (modelError) modelError.style.display = 'none';
        if (dataError) dataError.style.display = 'none';

        let hasError = false;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ –º–æ–¥–µ–ª–∏
        if (!modelFile.files.length) {
            if (modelError) {
                modelError.style.display = 'block';
                modelError.textContent = '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è';
            }
            hasError = true;
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ –¥–∞–Ω–Ω—ã—Ö
        if (!dataFile.files.length) {
            if (dataError) {
                dataError.style.display = 'block';
                dataError.textContent = '–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ';
            }
            hasError = true;
        }

        // –ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏, –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É
        if (hasError) {
            return false;
        }

        return true;
    }
</script>

{% endblock %}